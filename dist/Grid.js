class Grid{constructor(){this.minimumDistance=50/RESCALINGCONSTANT*DOMINANTSIDE,this.margin=50/RESCALINGCONSTANT*DOMINANTSIDE,this.boxes=[],this.possible_pairings_x=[],this.possible_pairings_y=[],this.boxes_complete_status=[],this.boxes_completely_run=!1,this.count_of_points_x=Math.round(getRandomFromInterval(2,5)),this.count_of_points_y=Math.round(getRandomFromInterval(2,5)),this.grid_label=this.count_of_points_x+"x"+this.count_of_points_y,MODE>1&&console.log("Grid: "+this.grid_label),this.columns_count=this.count_of_points_x+1,this.row_count=this.count_of_points_y+1,this.boxes_count=this.columns_count*this.row_count,MODE>1&&console.log("Grid with "+this.columns_count+" columns, "+this.row_count+" rows, "+this.boxes_count+" boxes and "+this.pairing_count+" planned pairings."),this.pairing_count=Math.round(getRandomFromInterval(1,4)),MODE>1&&console.log("Number of pairing: "+this.pairing_count),this.getPoints(),this.create_unpaired_boxes(),this.scout_possible_pairings();for(var s=0;s<this.pairing_count;s++)this.pairing_count>0&&this.possible_pairings_x.length>0&&this.possible_pairings_y.length>0&&(this.choose_pairing(),this.pair(),this.remove_used_pairs());MODE>1&&(console.log("The real boxes are:"),console.log(this.boxes)),this.create_lines()}getPoints(){this.standardStartX=0,this.standardEndX=100,this.standardPoolX=[...Array(this.standardEndX).keys()],this.standardStartY=0,this.standardEndY=100,this.standardPoolY=[...Array(this.standardEndY).keys()],this.marginStandard=Math.round(map(this.margin,0,width,this.standardStartX,this.standardEndX)),this.minimumDistanceStandard=Math.round(map(this.minimumDistance,0,width,this.standardStartX,this.standardEndX));for(var s=this.standardPoolX.length-1;s>=0;s--)(s<=0+this.marginStandard+this.minimumDistanceStandard||s>=this.standardEndX-this.marginStandard-this.minimumDistanceStandard)&&this.standardPoolX.splice(s,1);for(this.pointsX=[0+this.margin,width-this.margin],s=this.standardPoolY.length-1;s>=0;s--)(s<=0+this.marginStandard+this.minimumDistanceStandard||s>=this.standardEndY-this.marginStandard-this.minimumDistanceStandard)&&this.standardPoolY.splice(s,1);for(this.pointsY=[0+this.margin,height-this.margin],s=0;s<this.count_of_points_x;s++)this.getSinglePointX();for(s=0;s<this.count_of_points_y;s++)this.getSinglePointY();this.pointsX.sort((function(s,t){return s-t})),this.pointsY.sort((function(s,t){return s-t})),MODE>1&&(console.log("Coordinates of points on x axis: "+this.pointsX),console.log("Coordinates of points on y axis: "+this.pointsY))}getSinglePointX(){let s=getRandomFromList(this.standardPoolX),t=Math.round(map(s,this.standardStartX,this.standardEndX,0,width));for(var i=this.standardPoolX.length-1;i>=0;i--)this.standardPoolX[i]>=s-this.minimumDistanceStandard&&this.standardPoolX[i]<=s+this.minimumDistanceStandard&&this.standardPoolX.splice(i,1);this.pointsX.push(t)}getSinglePointY(){let s=getRandomFromList(this.standardPoolY),t=Math.round(map(s,this.standardStartY,this.standardEndY,0,height));for(var i=this.standardPoolY.length-1;i>=0;i--)this.standardPoolY[i]>=s-this.minimumDistanceStandard&&this.standardPoolY[i]<=s+this.minimumDistanceStandard&&this.standardPoolY.splice(i,1);this.pointsY.push(t)}create_unpaired_boxes(){this.label_counter=0;for(let s=0;s<this.row_count;s++)for(let t=0;t<this.columns_count;t++){this.label_counter+=1;let i={label:this.label_counter,a:createVector(this.pointsX[t],this.pointsY[s]),b:createVector(this.pointsX[t+1],this.pointsY[s]),c:createVector(this.pointsX[t+1],this.pointsY[s+1]),d:createVector(this.pointsX[t],this.pointsY[s+1])};this.boxes.push(new Box(i))}}scout_possible_pairings(){for(let s=0;s<this.boxes.length;s++)this.boxes[s].label%this.columns_count!=0&&this.possible_pairings_x.push({left:this.boxes[s].label,right:this.boxes[s+1].label}),this.boxes[s].label<=this.boxes.length-this.columns_count&&this.possible_pairings_y.push({left:this.boxes[s].label,right:this.boxes[s+this.columns_count].label});MODE>1&&(console.log(this.possible_pairings_x.length+" possible combinations for x:"),console.log(this.possible_pairings_x),console.log(this.possible_pairings_y.length+" possible combinations for y: "),console.log(this.possible_pairings_y))}choose_pairing(){fxrand()>=.5?(this.chosen_axis="x",this.chosen=getRandomFromList(this.possible_pairings_x),MODE>1&&(console.log("Pairing on the x axis with:"),console.log(this.chosen))):(this.chosen_axis="y",this.chosen=getRandomFromList(this.possible_pairings_y),MODE>1&&(console.log("Pairing on the y axis with:"),console.log(this.chosen)))}pair(){let s,t;for(let i of this.boxes)i.label==this.chosen.left?(s={a:i.a,b:i.b,c:i.c,d:i.d},this.left_label=i.label):i.label==this.chosen.right&&(t={a:i.a,b:i.b,c:i.c,d:i.d},this.right_label=i.label);if("x"==this.chosen_axis){let i={label:this.left_label+"+"+this.right_label,a:{x:s.a.x,y:s.a.y},b:{x:t.b.x,y:t.b.y},c:{x:t.c.x,y:t.c.y},d:{x:s.d.x,y:s.d.y}};this.paired_box=new Box(i)}else{let i={label:this.left_label+"+"+this.right_label,a:{x:s.a.x,y:s.a.y},b:{x:s.b.x,y:s.b.y},c:{x:t.c.x,y:t.c.y},d:{x:t.d.x,y:t.d.y}};this.paired_box=new Box(i)}MODE>1&&(console.log("Adding the newly paired box: "),console.log(this.paired_box)),this.boxes.push(this.paired_box),MODE>1&&console.log("Remove original boxes from array.");for(var i=this.boxes.length-1;i>=0;i--)this.boxes[i].label==this.left_label&&this.boxes.splice(i,1),this.boxes[i].label==this.right_label&&this.boxes.splice(i,1)}remove_used_pairs(){MODE>1&&console.log("Remove used pairs from both pools.");for(var s=this.possible_pairings_x.length-1;s>=0;s--)this.possible_pairings_x[s].left!=this.chosen.left&&this.possible_pairings_x[s].left!=this.chosen.right&&this.possible_pairings_x[s].right!=this.chosen.left&&this.possible_pairings_x[s].right!=this.chosen.right||this.possible_pairings_x.splice(s,1);for(s=this.possible_pairings_y.length-1;s>=0;s--)this.possible_pairings_y[s].left!=this.chosen.left&&this.possible_pairings_y[s].left!=this.chosen.right&&this.possible_pairings_y[s].right!=this.chosen.left&&this.possible_pairings_y[s].right!=this.chosen.right||this.possible_pairings_y.splice(s,1)}create_lines(){let s,t,i;for(let o of this.boxes){let e=getRandomFromList(["x","y","xy","yx"]);MODE>1&&console.log(e+" axis randomly chosen."),s=Math.round(getRandomFromInterval(0,1)),0==s?(t=PALETTE.hatches[0],i=PALETTE.primaries[1]):(t=PALETTE.hatches[1],i=PALETTE.primaries[0]),o.rothko=new RothkoRect({custom_width:o.c.x-o.a.x,custom_height:o.c.y-o.a.y,posX:o.a.x,posY:o.a.y,elementSizeMin:10/RESCALINGCONSTANT*DOMINANTSIDE,elementSizeMax:50/RESCALINGCONSTANT*DOMINANTSIDE,margin:0,fillColor:i,fillColorNoise:3,fillColorOpacity:10,noStroke:!1,strokeColor:color(PALETTE.rothkoStroke),strokeWeight:1/RESCALINGCONSTANT*DOMINANTSIDE,strokeColorNoise:3,strokeOpacity:ROTHKOSTROKEOPACITY,numberQuantisizer:20}),o.dirtLines=new dirtLines({custom_width:o.c.x-o.a.x,custom_height:o.c.y-o.a.y,margin:0,posX:o.a.x,posY:o.a.y,strokeColor:distortColorNew(color(PALETTE.dirtline),10,!1),strokeWeight:.2/RESCALINGCONSTANT*DOMINANTSIDE,strokeColorNoise:15,numberQuantisizer:getRandomFromInterval(200,600),length:20/RESCALINGCONSTANT*DOMINANTSIDE}),o.dirtCircles=new dirtCircles({custom_width:o.c.x-o.a.x,custom_height:o.c.y-o.a.y,margin:0,posX:o.a.x,posY:o.a.y,fillColor:color(PALETTE.dirtCircles),fillColorNoise:10,numberQuantisizer:200,radiusBase:.75,radiusNoise:.25}),o.hatches=new Hatches(e,o.a,o.c,t,0,0,DISTANCE_BETWEEN_LINES)}}show(s,t=!0){this.startFrame=s,this.boxes_complete_status=[];for(let s of this.boxes)t&&frameCount==this.startFrame&&(s.rothko.show(),s.dirtLines.show(),s.dirtCircles.show()),s.show(),s.hatches.show(),s.hatches.check_all_complete(),0==this.boxes_completely_run&&this.boxes_complete_status.push(s.hatches.all_lines_complete);this.boxes_completely_run=this.boxes_complete_status.every((s=>!0===s)),this.boxes_completely_run&&void 0===this.frameCountFinished&&(this.frameCountFinished=frameCount)}}class Box{constructor(s){this.label=s.label,this.a=s.a,this.b=s.b,this.c=s.c,this.d=s.d,this.radiusX=(this.b.x-this.a.x)/2,this.radiusY=(this.d.y-this.a.y)/2,this.center_x=this.a.x+this.radiusX,this.center_y=this.a.y+this.radiusY}show(){MODE>=5&&(push(),rectMode(CENTER),translate(this.center_x,this.center_y),noFill(),strokeWeight(1),stroke(51),rect(0,0,2*this.radiusX,2*this.radiusY),fill(0),ellipse(0,0,2),textFont(font),textSize(20),text(this.label,10,20),pop())}}